<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Advanced Trading Analysis Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { 
    background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 100%); 
    color:#eef3ff; 
    font-family: 'Segoe UI', Arial, sans-serif; 
    padding:0;
    min-height:100vh;
    position:relative;
    overflow-x:hidden;
  }
  body::before {
    content:'';
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background: radial-gradient(circle at 20% 50%, rgba(202,255,51,0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(6,182,212,0.06) 0%, transparent 50%);
    pointer-events:none;
    z-index:0;
  }
  
  /* Hero Section */
  .hero {
    position: relative;
    padding: 80px 32px 60px;
    overflow: hidden;
  }
  .hero::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, #caff33, transparent);
  }
  
  .container { position:relative; z-index:1; max-width:1400px; margin:0 auto; padding: 0 32px; }
  
  h1 { 
    font-size:72px; 
    font-weight:900; 
    margin-bottom:16px;
    background: linear-gradient(135deg, #caff33 0%, #06b6d4 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing:-2px;
    animation: fadeInDown 0.6s ease;
    line-height: 1.1;
  }
  
  .subtitle {
    font-size: 20px;
    opacity: 0.7;
    margin-bottom: 40px;
    animation: fadeInUp 0.6s ease 0.2s backwards;
  }
  
  /* Animations */
  @keyframes fadeInDown {
    from { opacity:0; transform:translateY(-20px); }
    to { opacity:1; transform:translateY(0); }
  }
  @keyframes fadeInUp {
    from { opacity:0; transform:translateY(20px); }
    to { opacity:1; transform:translateY(0); }
  }
  @keyframes slideInLeft {
    from { opacity:0; transform:translateX(-40px); }
    to { opacity:1; transform:translateX(0); }
  }
  @keyframes slideInRight {
    from { opacity:0; transform:translateX(40px); }
    to { opacity:1; transform:translateX(0); }
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
  }
  @keyframes glow {
    0%, 100% { box-shadow: 0 0 20px rgba(202,255,51,0.3); }
    50% { box-shadow: 0 0 40px rgba(202,255,51,0.6); }
  }
  
  /* Section Headers */
  .section {
    padding: 60px 0;
    position: relative;
  }
  
  .section-header {
    text-align: center;
    margin-bottom: 48px;
  }
  
  .section-title {
    font-size: 48px;
    font-weight: 800;
    margin-bottom: 16px;
    color: #caff33;
    text-transform: uppercase;
    letter-spacing: -1px;
  }
  
  .section-subtitle {
    font-size: 18px;
    opacity: 0.6;
    max-width: 600px;
    margin: 0 auto;
  }
  
  /* Cards */
  .row { display:flex; gap:20px; flex-wrap:wrap; margin-bottom: 32px; }
  .card { 
    background: rgba(22,34,56,0.6);
    backdrop-filter: blur(12px);
    padding:24px; 
    border-radius:16px;
    border:1px solid rgba(51,65,85,0.4);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(202,255,51,0.1), transparent);
    transition: left 0.6s;
  }
  .card:hover::before {
    left: 100%;
  }
  .card:hover {
    border-color: rgba(202,255,51,0.6);
    box-shadow: 0 8px 32px rgba(202,255,51,0.15);
    transform: translateY(-4px);
  }
  
  /* Controls */
  .controls { 
    display:flex; 
    gap:16px; 
    align-items:end; 
    flex-wrap:wrap;
  }
  .input-group { position:relative; }
  label { 
    font-size:11px; 
    opacity:.7; 
    display:block; 
    margin-bottom:8px;
    text-transform:uppercase;
    letter-spacing:0.5px;
    font-weight:600;
  }
  input { 
    background: rgba(15,23,42,0.8);
    color:#eef3ff; 
    border:2px solid #334155; 
    border-radius:8px; 
    padding:10px 14px; 
    width:140px;
    font-size:14px;
    font-weight:500;
    transition: all 0.3s ease;
  }
  input:focus {
    outline:none;
    border-color:#caff33;
    box-shadow: 0 0 0 3px rgba(202,255,51,0.1);
    background: rgba(15,23,42,0.95);
  }
  input:hover { border-color:#475569; }
  
  button { 
    padding:12px 24px; 
    background: linear-gradient(135deg, #caff33 0%, #a8d929 100%);
    border:none; 
    border-radius:8px; 
    font-weight:700; 
    cursor:pointer; 
    color:#001018;
    font-size:14px;
    text-transform:uppercase;
    letter-spacing:0.5px;
    transition: all 0.3s ease;
    position:relative;
    overflow:hidden;
  }
  button::before {
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    border-radius:50%;
    background:rgba(255,255,255,0.3);
    transform:translate(-50%,-50%);
    transition:width 0.6s, height 0.6s;
  }
  button:hover::before { width:300px; height:300px; }
  button:hover { 
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(202,255,51,0.4);
  }
  button:active { transform: translateY(0); }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  
  #randSeed {
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    color:#fff;
  }
  #randSeed:hover { box-shadow: 0 6px 20px rgba(6,182,212,0.4); }
  
  /* Stats */
  .stat-item {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 16px;
    border-radius: 8px;
    margin-bottom: 8px;
    background: rgba(15,23,42,0.4);
    transition: all 0.3s ease;
  }
  .stat-item:hover {
    background:rgba(202,255,51,0.1);
    transform: translateX(4px);
  }
  .stat-label {
    font-size:14px;
    opacity:0.8;
    font-weight: 500;
  }
  .stat-value {
    font-size:20px;
    font-weight:800;
    color:#caff33;
  }
  .stat-value.negative { color:#ef4444; }
  .stat-value.positive { color:#10b981; }
  
  h3 {
    font-size:24px;
    font-weight:700;
    margin-bottom:20px;
    color:#caff33;
    text-transform:uppercase;
    letter-spacing:1px;
  }
  
  .loading { opacity:0.5; pointer-events:none; }
  
  .ticker-badge {
    display:inline-block;
    background:rgba(6,182,212,0.2);
    color:#06b6d4;
    padding:6px 12px;
    border-radius:8px;
    margin:4px;
    font-size:12px;
    font-weight:700;
    border:1px solid rgba(6,182,212,0.3);
    transition: all 0.3s ease;
    cursor: pointer;
  }
  .ticker-badge:hover {
    background:rgba(6,182,212,0.4);
    transform: scale(1.08);
    box-shadow: 0 4px 12px rgba(6,182,212,0.3);
  }
  
  .error-message {
    background: rgba(239,68,68,0.2);
    border: 1px solid rgba(239,68,68,0.4);
    color: #fca5a5;
    padding: 16px;
    border-radius: 8px;
    animation: fadeInUp 0.3s ease;
  }
  
  /* Market Metrics Grid */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
  }
  
  .metric-card {
    background: rgba(22,34,56,0.6);
    backdrop-filter: blur(12px);
    padding: 24px;
    border-radius: 16px;
    border: 1px solid rgba(51,65,85,0.4);
    transition: all 0.4s ease;
    cursor: pointer;
  }
  
  .metric-card:hover {
    border-color: rgba(202,255,51,0.6);
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(202,255,51,0.2);
  }
  
  .metric-icon {
    font-size: 32px;
    margin-bottom: 12px;
    display: block;
  }
  
  .metric-label {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.6;
    margin-bottom: 8px;
  }
  
  .metric-value {
    font-size: 32px;
    font-weight: 900;
    color: #caff33;
    margin-bottom: 4px;
  }
  
  .metric-change {
    font-size: 14px;
    font-weight: 600;
  }
  
  .metric-change.up { color: #10b981; }
  .metric-change.down { color: #ef4444; }
  
  /* Terminal Style Analysis */
  .terminal {
    background: rgba(10,14,26,0.9);
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 20px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.6;
    max-height: 400px;
    overflow-y: auto;
    margin-bottom: 32px;
  }
  
  .terminal::-webkit-scrollbar {
    width: 8px;
  }
  
  .terminal::-webkit-scrollbar-track {
    background: rgba(15,23,42,0.5);
    border-radius: 4px;
  }
  
  .terminal::-webkit-scrollbar-thumb {
    background: #334155;
    border-radius: 4px;
  }
  
  .terminal::-webkit-scrollbar-thumb:hover {
    background: #475569;
  }
  
  .terminal-line {
    margin-bottom: 8px;
    animation: fadeInUp 0.3s ease;
  }
  
  .terminal-prompt {
    color: #caff33;
    font-weight: bold;
  }
  
  .terminal-output {
    color: #06b6d4;
  }
  
  .terminal-warning {
    color: #fbbf24;
  }
  
  .terminal-error {
    color: #ef4444;
  }
  
  .terminal-success {
    color: #10b981;
  }
  
  /* Trading Signals Panel */
  .signals-panel {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
  }
  
  .signal-item {
    background: rgba(15,23,42,0.6);
    padding: 16px;
    border-radius: 12px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .signal-item.long {
    border-color: rgba(16,185,129,0.4);
  }
  
  .signal-item.flat {
    border-color: rgba(148,163,184,0.4);
  }
  
  .signal-item:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  }
  
  .signal-ticker {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 8px;
    color: #caff33;
  }
  
  .signal-status {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  .signal-status.long { color: #10b981; }
  .signal-status.flat { color: #94a3b8; }
  
  /* Chart Container */
  .chart-container {
    position: relative;
    height: 450px;
    margin-bottom: 32px;
  }
  
  canvas { height:100% !important; width:100%; }
  
  /* Scroll Progress Bar */
  .scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 3px;
    background: linear-gradient(90deg, #caff33, #06b6d4);
    z-index: 1000;
    transition: width 0.1s ease;
  }
  
  /* Live Indicator */
  .live-indicator {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(16,185,129,0.2);
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid rgba(16,185,129,0.4);
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 20px;
  }
  
  .live-dot {
    width: 8px;
    height: 8px;
    background: #10b981;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    h1 { font-size: 48px; }
    .section-title { font-size: 32px; }
    .hero { padding: 60px 24px 40px; }
  }
</style>
</head>
<body>

<div class="scroll-progress" id="scrollProgress"></div>

<div class="hero">
  <div class="container">
    <h1>TRADING COMMAND CENTER</h1>
    <p class="subtitle">Advanced algorithmic portfolio analysis powered by real-time NSE market data</p>
    <div class="live-indicator">
      <span class="live-dot"></span>
      <span>LIVE MARKET DATA</span>
    </div>
  </div>
</div>

<div class="section">
  <div class="container">
    <div class="controls card">
      <div class="input-group">
        <label># Stocks (n)</label>
        <input id="n" type="number" min="5" max="16" value="8">
      </div>
      <div class="input-group">
        <label>Backtest Days</label>
        <input id="days" type="number" min="30" max="300" value="60">
      </div>
      <div class="input-group">
        <label>Amount (‚Çπ)</label>
        <input id="amount" type="number" min="1000" step="100" value="10000">
      </div>
      <div class="input-group">
        <label>Seed</label>
        <input id="seed" type="number" value="42">
      </div>
      <div>
        <button id="randSeed">üé≤ Random Seed</button>
      </div>
      <div>
        <button id="run">‚ñ∂ Run Backtest</button>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Performance Metrics</h2>
      <p class="section-subtitle">Real-time portfolio analytics and market behavior analysis</p>
    </div>
    
    <div class="metrics-grid" id="metricsGrid">
      <div class="metric-card">
        <span class="metric-icon">üìà</span>
        <div class="metric-label">Total Return</div>
        <div class="metric-value" id="returnValue">--</div>
        <div class="metric-change" id="returnChange">Calculating...</div>
      </div>
      
      <div class="metric-card">
        <span class="metric-icon">‚ö°</span>
        <div class="metric-label">Sharpe Ratio</div>
        <div class="metric-value" id="sharpeValue">--</div>
        <div class="metric-change">Risk-adjusted returns</div>
      </div>
      
      <div class="metric-card">
        <span class="metric-icon">üìâ</span>
        <div class="metric-label">Max Drawdown</div>
        <div class="metric-value" id="drawdownValue">--</div>
        <div class="metric-change">Peak to trough decline</div>
      </div>
      
      <div class="metric-card">
        <span class="metric-icon">üéØ</span>
        <div class="metric-label">Win Rate</div>
        <div class="metric-value" id="winrateValue">--</div>
        <div class="metric-change">Profitable days</div>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="container">
    <div class="card">
      <h3>üìä Equity Curve Analysis</h3>
      <div class="chart-container">
        <canvas id="chart"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="container">
    <div class="card">
      <h3>üíª Terminal Output</h3>
      <div class="terminal" id="terminal">
        <div class="terminal-line">
          <span class="terminal-prompt">$</span> <span class="terminal-output">Initializing Trading Analysis Engine...</span>
        </div>
        <div class="terminal-line">
          <span class="terminal-prompt">$</span> <span class="terminal-output">Waiting for backtest execution...</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="container">
    <div class="row">
      <div class="card" style="flex:1">
        <h3>üìã Portfolio Composition</h3>
        <div id="stats"></div>
      </div>
      
      <div class="card" style="flex:1">
        <h3>üéØ Trading Signals</h3>
        <div class="signals-panel" id="signals"></div>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="container">
    <div class="card">
      <h3>üìä Market Behavior Analysis</h3>
      <div id="marketAnalysis">
        <p style="opacity:0.6; text-align:center; padding:40px 0;">Run a backtest to generate market behavior insights</p>
      </div>
    </div>
  </div>
</div>

<script>
let chart = null;
let terminalLines = [];

// Scroll Progress Bar
window.addEventListener('scroll', () => {
  const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
  const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
  const scrolled = (winScroll / height) * 100;
  document.getElementById('scrollProgress').style.width = scrolled + '%';
});

function addTerminalLine(text, type = 'output') {
  const terminal = document.getElementById('terminal');
  const line = document.createElement('div');
  line.className = 'terminal-line';
  line.innerHTML = `<span class="terminal-prompt">$</span> <span class="terminal-${type}">${text}</span>`;
  terminal.appendChild(line);
  terminal.scrollTop = terminal.scrollHeight;
}

function randomSeed(){
  const s = Math.floor(Math.random()*1e9);
  document.getElementById("seed").value = s;
  const btn = document.getElementById("randSeed");
  btn.style.animation = "pulse 0.5s ease";
  setTimeout(() => btn.style.animation = "", 500);
  addTerminalLine(`Generated random seed: ${s}`, 'success');
}

function calculateWinRate(values) {
  let wins = 0;
  for(let i = 1; i < values.length; i++) {
    if(values[i] > values[i-1]) wins++;
  }
  return ((wins / (values.length - 1)) * 100).toFixed(1);
}

function generateMarketAnalysis(data) {
  const avgReturn = data.total_return / (data.dates.length / 30);
  const volatility = data.sharpe > 0 ? "LOW" : data.sharpe > -0.5 ? "MODERATE" : "HIGH";
  const trend = data.total_return > 0 ? "BULLISH" : "BEARISH";
  
  const longSignals = Object.values(data.signals).filter(s => s === "LONG").length;
  const marketSentiment = (longSignals / data.tickers.length * 100).toFixed(0);
  
  return `
    <div class="row">
      <div class="card" style="flex:1">
        <div class="stat-item">
          <span class="stat-label">Market Trend</span>
          <span class="stat-value ${trend === 'BULLISH' ? 'positive' : 'negative'}">${trend}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Volatility Regime</span>
          <span class="stat-value">${volatility}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Avg Monthly Return</span>
          <span class="stat-value">${avgReturn.toFixed(2)}%</span>
        </div>
      </div>
      
      <div class="card" style="flex:1">
        <div class="stat-item">
          <span class="stat-label">Market Sentiment</span>
          <span class="stat-value">${marketSentiment}% Bullish</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Active Positions</span>
          <span class="stat-value positive">${longSignals}/${data.tickers.length}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Strategy Type</span>
          <span class="stat-value">SMA Crossover</span>
        </div>
      </div>
    </div>
    
    <div style="margin-top:20px; padding:20px; background:rgba(202,255,51,0.1); border-radius:12px; border:1px solid rgba(202,255,51,0.3);">
      <h4 style="color:#caff33; margin-bottom:12px; font-size:16px;">üí° AI Insights</h4>
      <p style="line-height:1.8; opacity:0.9;">
        ${data.total_return > 0 
          ? `Portfolio demonstrates strong positive momentum with ${data.total_return}% returns. The Sharpe ratio of ${data.sharpe} indicates ${data.sharpe > 1 ? 'excellent' : 'moderate'} risk-adjusted performance.`
          : `Portfolio experiencing drawdown phase with ${data.total_return}% returns. Consider rebalancing strategy or adjusting position sizing.`
        }
        Current market regime shows ${volatility} volatility with ${longSignals} active long positions across the portfolio.
      </p>
    </div>
  `;
}

async function run(){
  const n = document.getElementById("n").value;
  const days = document.getElementById("days").value;
  const amount = document.getElementById("amount").value;
  const seed = document.getElementById("seed").value;

  const runBtn = document.getElementById("run");
  runBtn.disabled = true;
  runBtn.textContent = "‚è≥ Processing...";

  addTerminalLine(`Initiating backtest with ${n} stocks over ${days} days...`, 'output');
  addTerminalLine(`Capital allocation: ‚Çπ${amount}`, 'output');
  
  const statsDiv = document.getElementById("stats");
  const signalsDiv = document.getElementById("signals");
  statsDiv.innerHTML = "<p style='opacity:0.6;'>Loading portfolio data...</p>";
  signalsDiv.innerHTML = "<p style='opacity:0.6;'>Analyzing signals...</p>";

  try {
    addTerminalLine('Fetching market data from Yahoo Finance...', 'output');
    const res = await fetch(`/api/portfolio?n=${n}&days=${days}&amount=${amount}&seed=${seed}`);
    const data = await res.json();
    
    if (data.error || !res.ok){ 
      addTerminalLine(`ERROR: ${data.error || 'Failed to fetch data'}`, 'error');
      statsDiv.innerHTML = `<div class="error-message">‚ùå ${data.error || 'Failed to fetch data'}</div>`;
      signalsDiv.innerHTML = "";
      runBtn.disabled = false;
      runBtn.textContent = "‚ñ∂ Run Backtest";
      return; 
    }

    addTerminalLine('Data fetched successfully', 'success');
    addTerminalLine(`Processing ${data.tickers.length} tickers: ${data.tickers.join(', ')}`, 'output');
    addTerminalLine('Calculating technical indicators (SMA 10/30)...', 'output');
    addTerminalLine('Generating trading signals...', 'output');
    addTerminalLine('Computing performance metrics...', 'success');

    // Update metrics cards
    const returnClass = data.total_return >= 0 ? 'up' : 'down';
    document.getElementById('returnValue').textContent = `${data.total_return > 0 ? '+' : ''}${data.total_return}%`;
    document.getElementById('returnChange').textContent = data.total_return >= 0 ? '‚ñ≤ Positive returns' : '‚ñº Negative returns';
    document.getElementById('returnChange').className = `metric-change ${returnClass}`;
    
    document.getElementById('sharpeValue').textContent = data.sharpe;
    document.getElementById('drawdownValue').textContent = `${data.max_drawdown}%`;
    
    const winRate = calculateWinRate(data.values);
    document.getElementById('winrateValue').textContent = `${winRate}%`;

    // Portfolio composition
    const tickerBadges = data.tickers.map(t => `<span class="ticker-badge">${t}</span>`).join("");
    statsDiv.innerHTML = `
      <div class="stat-item">
        <span class="stat-label">Portfolio Size</span>
        <span class="stat-value">${data.tickers.length} Stocks</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Initial Capital</span>
        <span class="stat-value">‚Çπ${amount}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Final Value</span>
        <span class="stat-value">‚Çπ${data.values[data.values.length-1].toFixed(2)}</span>
      </div>
      <div style="margin-top:20px;">
        <div class="stat-label" style="margin-bottom:12px;">Holdings</div>
        ${tickerBadges}
      </div>
    `;

    // Trading signals
    let signalHTML = "";
    for (const ticker in data.signals){
      const signal = data.signals[ticker];
      const signalClass = signal === "LONG" ? "long" : "flat";
      signalHTML += `
        <div class="signal-item ${signalClass}">
          <div class="signal-ticker">${ticker}</div>
          <div class="signal-status ${signalClass.toLowerCase()}">${signal}</div>
        </div>
      `;
    }
    signalsDiv.innerHTML = signalHTML;
    
    addTerminalLine(`Generated ${Object.keys(data.signals).length} trading signals`, 'success');

    // Market Analysis
    document.getElementById('marketAnalysis').innerHTML = generateMarketAnalysis(data);
    addTerminalLine('Market behavior analysis complete', 'success');

    // Chart with gradient
    if (chart) chart.destroy();
    const ctx = document.getElementById("chart").getContext("2d");
    const gradient = ctx.createLinearGradient(0, 0, 0, 450);
    gradient.addColorStop(0, "rgba(202,255,51,0.4)");
    gradient.addColorStop(1, "rgba(6,182,212,0.05)");

    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: data.dates,
        datasets: [{
          label: "Portfolio Value (‚Çπ)",
          data: data.values,
          borderColor: "#caff33",
          backgroundColor: gradient,
          borderWidth: 3,
          pointRadius: 0,
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          intersect: false,
          mode: 'index',
        },
        plugins: {
          legend: {
            labels: { 
              color: "#eef3ff", 
              font: { size: 14, weight: "600" },
              padding: 20
            }
          },
          tooltip: {
            backgroundColor: 'rgba(10,14,26,0.95)',
            titleColor: '#caff33',
            bodyColor: '#eef3ff',
            borderColor: '#caff33',
            borderWidth: 2,
            padding: 16,
            displayColors: false,
            titleFont: { size: 14, weight: 'bold' },
            bodyFont: { size: 13 },
            callbacks: {
              label: function(context) {
                const value = context.parsed.y;
                const change = context.dataIndex > 0 
                  ? ((value - data.values[0]) / data.values[0] * 100).toFixed(2)
                  : 0;
                return [
                  `Value: ‚Çπ${value.toFixed(2)}`,
                  `Change: ${change > 0 ? '+' : ''}${change}%`
                ];
              }
            }
          }
        },
        scales: {
          x: { 
            ticks: { 
              color: "#94a3b8",
              maxRotation: 45,
              minRotation: 45
            },
            grid: { 
              color: "rgba(51,65,85,0.2)",
              drawBorder: false
            }
          },
          y: { 
            ticks: { 
              color: "#94a3b8",
              callback: function(value) {
                return '‚Çπ' + value.toFixed(0);
              }
            },
            grid: { 
              color: "rgba(51,65,85,0.2)",
              drawBorder: false
            }
          }
        }
      }
    });

    chart.options.animation = {
      duration: 2000,
      easing: "easeInOutQuart"
    };
    chart.update();
    
    addTerminalLine('Equity curve rendered successfully', 'success');
    addTerminalLine(`BACKTEST COMPLETE | Return: ${data.total_return}% | Sharpe: ${data.sharpe} | Max DD: ${data.max_drawdown}%`, 'success');

  } catch(error) {
    console.error('Fetch error:', error);
    addTerminalLine(`FATAL ERROR: ${error.message}`, 'error');
    statsDiv.innerHTML = `<div class="error-message">‚ùå Network Error: ${error.message}</div>`;
    signalsDiv.innerHTML = "";
  } finally {
    runBtn.disabled = false;
    runBtn.textContent = "‚ñ∂ Run Backtest";
  }
}

document.getElementById("run").addEventListener("click", run);
document.getElementById("randSeed").addEventListener("click", randomSeed);

// Initial render
addTerminalLine('System ready. Configure parameters and click Run Backtest.', 'success');
run();
</script>

</body>
</html>